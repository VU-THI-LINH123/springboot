{"ast":null,"code":"import { DOM_KENDO_ITEM_ID_FIELD, DOM_KENDO_TREEVIEW_GUID_FIELD } from './utils/consts';\nvar DROPZONE_BOUNDARY_DELTA = 6;\n/**\n * A class which provides an API for analyzing the `drag` events\n * of the TreeView.\n *\n * @example\n * ```jsx\n * class App extends React.Component {\n *     dragClue;\n *     state = { tree };\n *\n *     render() {\n *         return (\n *             <div>\n *                 <TreeView data={this.state.tree} draggable={true}\n *                     onItemDragOver={this.onItemDragOver} onItemDragEnd={this.onItemDragEnd} />\n *                 <TreeViewDragClue ref={dragClue => this.dragClue = dragClue} />\n *             </div>\n *         );\n *     }\n *\n *     onItemDragOver = (event) => {\n *         this.dragClue.show(event.pageY + 10, event.pageX, event.item.text, this.getClueClassName(event));\n *     }\n *     onItemDragEnd = (event) => {\n *         this.dragClue.hide();\n *         const eventAnalyzer = new TreeViewDragAnalyzer(event).init();\n *\n *         if (eventAnalyzer.isDropAllowed) {\n *             const updatedTree = moveTreeViewItem(\n *                 event.itemHierarchicalIndex,\n *                 this.state.tree,\n *                 eventAnalyzer.getDropOperation(),\n *                 eventAnalyzer.destinationMeta.itemHierarchicalIndex,\n *             );\n *\n *             this.setState({ tree: updatedTree });\n *         }\n *     }\n *     getClueClassName(event) {\n *         const eventAnalyzer = new TreeViewDragAnalyzer(event).init();\n *         const itemIndex = eventAnalyzer.destinationMeta.itemHierarchicalIndex;\n *\n *         if (eventAnalyzer.isDropAllowed) {\n *             switch (eventAnalyzer.getDropOperation()) {\n *                 case 'child':\n *                     return 'k-i-plus';\n *                 case 'before':\n *                     return itemIndex === '0' || itemIndex.endsWith(`${SEPARATOR}0`) ?\n *                         'k-i-insert-up' : 'k-i-insert-middle';\n *                 case 'after':\n *                     const siblings = getSiblings(itemIndex, this.state.tree);\n *                     const lastIndex = Number(itemIndex.split(SEPARATOR).pop());\n *\n *                     return lastIndex < siblings.length - 1 ? 'k-i-insert-middle' : 'k-i-insert-down';\n *                 default:\n *                     break;\n *             }\n *         }\n *\n *         return 'k-i-cancel';\n *     }\n * }\n *\n * function getSiblings(itemIndex, data) {\n *     let result = data;\n *\n *     const indices = itemIndex.split(SEPARATOR).map(index => Number(index));\n *     for (let i = 0; i < indices.length - 1; i++) {\n *         result = result[indices[i]].items;\n *     }\n *\n *     return result;\n * }\n *\n * const SEPARATOR = '_';\n * const tree = [{\n *     text: 'Furniture', expanded: true, items: [\n *         { text: 'Tables & Chairs', expanded: true },\n *         { text: 'Sofas', expanded: true },\n *         { text: 'Occasional Furniture', expanded: true }]\n * }, {\n *     text: 'Decor', expanded: true, items: [\n *         { text: 'Bed Linen', expanded: true },\n *         { text: 'Curtains & Blinds', expanded: true },\n *         { text: 'Carpets', expanded: true }]\n * }];\n *\n * ReactDOM.render(<App />, document.querySelector('my-app'));\n * ```\n */\n\nvar TreeViewDragAnalyzer =\n/** @class */\nfunction () {\n  /**\n   * @param event - The event that will be analyzed.\n   */\n  function TreeViewDragAnalyzer(event) {\n    this.event = event;\n    this.initialized = false;\n    this.itemId = event.itemHierarchicalIndex;\n    this.treeViewGuid = event.target.guid;\n  }\n  /**\n   * The method which initializes the analyzer.\n   * Invoke the method before you call any other methods.\n   *\n   * @returns - The analyzer object of the `drag` event.\n   */\n\n\n  TreeViewDragAnalyzer.prototype.init = function () {\n    if (!this.initialized) {\n      this.setDestimationMeta(document.elementFromPoint(this.event.clientX, this.event.clientY));\n      this.initialized = true;\n    }\n\n    return this;\n  };\n\n  Object.defineProperty(TreeViewDragAnalyzer.prototype, \"isDropAllowed\", {\n    /**\n     * Returns `true` if dropping is allowed. Otherwise, returns `false`.\n     */\n    get: function get() {\n      if (this.initialized && this.destItemId && this.destTreeViewGuid) {\n        // Disallow circular references.\n        return !(this.destTreeViewGuid + \"_\" + this.destItemId + \"_\").startsWith(this.treeViewGuid + \"_\" + this.itemId + \"_\");\n      } else {\n        return false;\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(TreeViewDragAnalyzer.prototype, \"destinationMeta\", {\n    /**\n     * Returns an object which contains:\n     * * The `itemHierarchicalIndex` of the destination item (the item below the dragged item) and\n     * * The `guid` of the destination TreeView (the TreeView which renders the destination item).\n     */\n    get: function get() {\n      return {\n        itemHierarchicalIndex: this.destItemId,\n        treeViewGuid: this.destTreeViewGuid\n      };\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\n   * Returns the specific drop operation.\n   *\n   * @returns - The following values are returned:\n   * * `before`&mdash;Indicates that the dragged item is positioned at the beginning of the destination item.\n   * * `after`&mdash;Indicates that the dragged item is positioned at the end of the destination item.\n   * * `child`&mdash;Indicates that the dragged item is positioned in the middle of the destination item.\n   * * `undefined`&mdash;Indicates that dropping is not allowed.\n   */\n\n  TreeViewDragAnalyzer.prototype.getDropOperation = function () {\n    if (this.initialized && this.isDropAllowed) {\n      var _a = this.destDomNodeWithMeta.getBoundingClientRect(),\n          top_1 = _a.top,\n          height = _a.height;\n\n      if (top_1 + height - this.event.clientY < DROPZONE_BOUNDARY_DELTA) {\n        return 'after';\n      } else if (this.event.clientY - top_1 < DROPZONE_BOUNDARY_DELTA) {\n        return 'before';\n      } else {\n        return 'child';\n      }\n    } else {\n      return undefined;\n    }\n  };\n\n  TreeViewDragAnalyzer.prototype.setDestimationMeta = function (element) {\n    var node = element;\n\n    while (node && !node[DOM_KENDO_ITEM_ID_FIELD]) {\n      node = node.parentNode;\n    }\n\n    if (node && node[DOM_KENDO_ITEM_ID_FIELD]) {\n      this.destDomNodeWithMeta = node;\n      this.destItemId = node[DOM_KENDO_ITEM_ID_FIELD];\n      this.destTreeViewGuid = node[DOM_KENDO_TREEVIEW_GUID_FIELD];\n    }\n  };\n\n  return TreeViewDragAnalyzer;\n}();\n\nexport default TreeViewDragAnalyzer;","map":null,"metadata":{},"sourceType":"module"}